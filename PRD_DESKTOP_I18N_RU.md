# PRD: Руссификация Desktop (дистрибутив `is`)

## 1. Контекст

Ветка `distro` уже содержит i18n foundation для desktop:
- словари в `ui/desktop/src/i18n/`
- функцию `t('key', 'Fallback')`
- выбор локали через `GOOSE_LOCALE`

Согласно `CUSTOM_DISTROS.md`, локализация дистрибутива делается через добавление каталога переводов и настройку `GOOSE_LOCALE`.

## 2. Цель

Добавить полноценную русскую локализацию desktop-интерфейса в ветке `is/*`, не меняя upstream-ветки и не ломая английский fallback.

## 3. Scope

### Входит
- Добавление `ui/desktop/src/i18n/ru.json`
- Подключение `ru` в `ui/desktop/src/i18n/index.ts`
- Проверки паритета ключей `en.json` и `ru.json` в `ui/desktop/src/i18n/i18n.test.ts`
- Настройка локали дистрибутива через `GOOSE_LOCALE=ru` (или `ru-RU`)
- Обновление документации дистрибутива по включению RU-локали

### Не входит
- Изменения в upstream PR
- Добавление language selector в UI
- Перевод CLI и server сообщений
- Новые CI guardrails под upstream

## 4. Функциональные требования

1. При `GOOSE_LOCALE=ru` интерфейс отображает строки из `ru.json`.
2. При отсутствии ключа в `ru.json` используется `en.json`, затем fallback-строка из `t(...)`.
3. Формат дат/времени учитывает locale tag (`ru-RU`) и не падает на POSIX-формах (`ru_RU.UTF-8`).
4. При `GOOSE_LOCALE` вне поддерживаемых словарей UI остается рабочим на английском.

## 5. Нефункциональные требования

1. Нулевые изменения в behavior backend/API.
2. Типизация и тесты `ui/desktop` проходят.
3. Изменения локализованы в desktop-слое.

## 6. Технический план

### Этап 1. Каталог переводов
- Скопировать структуру ключей из `en.json` в `ru.json`.
- Заполнить RU-значения для всех ключей.

### Этап 2. Runtime i18n
- Добавить `ru` в словари в `ui/desktop/src/i18n/index.ts`.
- Убедиться, что `currentLocaleTag()` корректно отрабатывает `ru_RU.UTF-8` -> `ru-RU`.

### Этап 3. Тесты
- Проверка паритета ключей `en.json`/`ru.json`.
- Проверка возврата RU-строки для известного ключа.
- Проверка fallback на EN и fallback-строку.

### Этап 4. Документация
- Добавить краткую инструкцию для дистрибутива:
  - где хранится `ru.json`
  - как включить `GOOSE_LOCALE=ru`

## 7. Критерии приемки

1. `cd ui/desktop && npm run test:run -- src/i18n/i18n.test.ts` — успешно.
2. `cd ui/desktop && npm run typecheck` — успешно.
3. При запуске desktop с `GOOSE_LOCALE=ru` ключевые экраны показывают русский текст.
4. При удалении одного ключа из `ru.json` UI не падает, используется EN/fallback.

## 8. Риски и меры

1. Риск: рассинхрон ключей между `en.json` и `ru.json`.
- Мера: тест паритета ключей.

2. Риск: некорректный locale tag от окружения.
- Мера: нормализация + валидация locale tag в `currentLocaleTag()`.

3. Риск: неполный перевод UX-критичных строк.
- Мера: smoke-проверка экранов Sessions/Recipes/Schedule/Settings/Toasts.

## 9. Definition of Done

- RU-каталог добавлен и подключен.
- Тесты и typecheck зеленые.
- Документация дистрибутива обновлена.
- Изменения зафиксированы в ветке `is/*` и готовы к интеграции в `distro`.
