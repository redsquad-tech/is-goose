---
ID: 6
Title: Desktop diagnostics, Add send-logs flow with server-side stub
Complexity: medium
BlockedBy:
  - "реализовать поддержку всплывающих подсказок"
  - "реализовать хранение ключей приложения"
  - "поддержка сохранения конфигурации"
---

# Desktop diagnostics, Add send-logs flow with server-side stub

## 1. Executive Summary

**Abstract:**  
Нужен минимальный пользовательский сценарий отправки логов из desktop-приложения: пункт в нативном меню и серверная заглушка команды отправки логов. Команда должна передаваться через существующий контракт сообщений Desktop↔Server (см. `docs/requirements/GOOSE_CORE_REQUIREMENTS.md`, `POST /reply`), без внедрения отдельного transport-слоя.

**Objectives (SMART):**
- **Specific:** Добавить задачу на реализацию пункта `Send Logs` и server-side stub для запуска отправки логов по команде.
- **Measurable:** Описан детальный контракт вызова, блокеры, допущения и критерии приемки.
- **Achievable:** Реализуется в текущем Electron + TypeScript стеке с локальными изменениями.
- **Relevant:** Поддерживает диагностику и поддержку пользователей без внедрения внешних сервисов.
- **Time-bound:** Один этап разработки после разблокировки зависимостей.

## 2. Context & Problem Statement

### Current State

- В проекте есть контракт сообщений между desktop и сервером (через `/reply`), который нужно использовать для передачи команд.
- Появилась потребность в пользовательском действии `Send Logs`.
- Для отправки логов требуется конфигурация/ключи и пользовательская обратная связь.

### The "Why"

Нужна серверная заглушка обработки команды отправки логов, чтобы запускать поток диагностики через уже существующий message-контракт и не блокировать пользовательскую поддержку.

### In Scope

- Добавить в desktop приложение пользовательский trigger `Send Logs`.
- Добавить серверную заглушку команды отправки логов.
- Зафиксировать `TODO`-точку для замены заглушки на полноценную бизнес-реализацию отправки логов.
- Определить минимальный контракт успеха/ошибки для trigger-а.

### Out of Scope

- Реализация полноценного чата.
- Полная система хранения секретов (в этой задаче только допущение готовности).
- Редизайн существующих требований OpenAPI.

## 3. Proposed Technical Solution

### Architecture Overview

1. Desktop main добавляет нативный пункт меню `Help -> Send Logs`.
2. Действие меню отправляет команду через существующий Desktop↔Server message-контракт (`/reply`).
3. Серверная заглушка распознает команду и запускает отправку логов через временную реализацию.
4. В коде заглушки оставляется явный `TODO` на замену временной реализации полноценной бизнес-логикой.

### Interface Changes

- Desktop API (IPC) получает метод для ручного запуска отправки логов через message-вызов к серверу.
- Сервер получает временный handler команды отправки логов внутри существующего message-потока и унифицированный ответ:
  - `ok: boolean`
  - `message: string`
  - `artifactPath?: string`
  - `remotePath?: string`

### Project Code Reference

- Desktop main/preload/shared API:
  - `src/desktop/main/index.ts`
  - `src/desktop/preload/index.ts`
  - `src/desktop/shared/api.ts`
- Сервер:
  - `src/server/app.ts`
  - `src/server/index.ts`
- Контракт сообщений:
  - `docs/requirements/GOOSE_CORE_REQUIREMENTS.md`
  - `docs/requirements/GOOSE_SERVER_OPENAPI.json` (`POST /reply`)

### Dependencies / Blockers

Задача блокируется до завершения:
- `реализовать поддержку всплывающих подсказок`
- `реализовать хранение ключей приложения`
- `поддержка сохранения конфигурации`

### Assumptions

Для реализации этой задачи считаем, что:
- всплывающие подсказки уже работают,
- хранение ключей приложения уже работает (client-managed per-key secrets),
- сохранение конфигурации уже работает.
- backend получает секреты только через env при запуске из desktop main.

## 4. Requirements

- `MUST` зафиксировать статус задачи как blocked указанными зависимостями до их завершения.
- `MUST` добавить пользовательский trigger `Send Logs` в нативное desktop-меню.
- `MUST` отправлять команду `Send Logs` через существующий Desktop↔Server контракт сообщений (`POST /reply`), без отдельного command-bus.
- `MUST` реализовать server-side заглушку, которая распознает команду в message-потоке и запускает отправку логов на заданную команду.
- `MUST` оставить в server-side заглушке явный `TODO`, указывающий место замены временной реализации на полноценную бизнес-реализацию отправки логов.
- `MUST` вернуть детерминированный результат вызова с полями `ok` и `message`.
- `SHOULD` возвращать `artifactPath` и `remotePath` при успешной отправке.
- `SHOULD` не раскрывать секреты/ключи в сообщениях ошибки.
- `MAY` логировать технические детали сбоя во внутренний лог без утечки чувствительных данных.
- `WON'T` внедрять чатовый интерфейс в рамках этой задачи.

## 5. Acceptance Criteria

- `MUST` задача содержит явный список блокеров в формате, пригодном для трекинга в `docs/tasks`.
- `MUST` в спецификации задачи явно указано допущение о работоспособности подсказок, ключей и конфигурации.
- `MUST` описано использование существующего message-контракта Desktop↔Server (`POST /reply`) для передачи команды отправки логов.
- `MUST` описан серверный stub-обработчик отправки логов как временное решение внутри message-потока.
- `MUST` зафиксирована `TODO`-точка для будущей замены stub-реализации на полноценную бизнес-реализацию.
- `MUST` описан контракт результата вызова (`ok`, `message`) и поведение при ошибках.
